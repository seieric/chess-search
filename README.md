# chess-search

このプログラムではchess-likeな次のゲームに対して、与えられた初期配置が先手必勝であるかどうかを探索します。

## ゲーム

2人でチェスの駒（ナイトなど何でもよい）を用いて対決する。

- 最初にチェス盤上にチェスの駒が１つ置かれている。
- 先手はその駒を普通のチェスの動きでどこかへ動かす。
- 後手もその駒を普通のチェスの動きでどこかへ動かす。ただし前にいたことのあるマス目の再訪は禁じられている。
- これを交互に繰り返す。
- 最初に動けなくなった方が負けである。

## 実行環境

通常のPython処理系（CPython）では実行速度が遅いため、実行には[PyPy](https://pypy.org/)を使うことが推奨されます。
パッケージ管理ツールuvを利用できる環境であれば、下記の手順に従ってコマンドを実行すると自動でPyPyがインストールされます。

## 使い方

### セットアップ

- uvが利用できる環境：`uv sync`を実行してください。
  - PyPyと開発用のパッケージが一度にインストールされます。
- uvが利用できない環境：Python 3.11対応のPyPyをインストールしてください。
  - 標準ライブラリだけで実装されているため、パッケージのインストールは不要です。

### 探索の実行

探索プログラムは`main.py`が中心となっています。`main.py`に適切な引数を渡して実行することで探索が行えます。

引数は次のとおりです。
```bash
python3 main.py [-h] [--verbose] [--heuristic] height width initial_row initial_col piece_type max_depth num_playout 
```

- `height`：チェスボードの高さ（行数）
- `width`：チェスボードの幅（列数）
- `initial_row`：初期状態で駒がある行（0-index）
- `initial_col`：初期状態で駒がある列（0-index）
- `piece_type`：駒の種類（`rook`, `king`, `queen`, `knight`）
- `max_depth`：探索の最大深さ。この深さを超えると再帰的な探索は行われず、プレイアウトによる勝率が盤面の評価値として返される。
- `num_playout`：プレイアウトの回数。`max_depth`を超えた深さで各盤面に対して何回プレイアウトを行うかを指定する。

例えば、4×4の盤面でルークを使ったゲームを探索するには次のコマンドを実行します。
```bash
uv run main.py 4 4 0 0 rook 100 0
```
このコマンドでは、駒の初期位置を盤面の左上に指定しています。また、`max_depth`を考えられる最大の深さ16よりも大きくすることでプレイアウトの利用を無効化しています。

ヒューリスティクスを利用した探索を行うには、次のようなコマンドを実行します。
```bash
uv run main.py --heuristic 4 4 0 0 rook 100 0
```

再帰的な探索をある深さ（例：5）で打ち切り、プレイアウトを行わせたい場合は次のようなコマンドを実行します。
```bash
uv run main.py --heuristic 4 4 0 0 rook 5 100
```
このコマンドでは深さ5を超えると各盤面で100回のプレイアウトが行われ、その勝率がその盤面の評価値として返されます。

### ソースの説明
```
.
├── main.py
├── modules
│   ├── board.py
│   ├── __init__.py
│   └── minimax.py
├── pyproject.toml
├── README.md
├── scripts
│   ├── search1.sh
│   ├── search2.sh
│   └── search3.sh
└── uv.lock
```

- `main.py`：中心となるプログラム。このプログラムが`minimax.py`や`board.py`をインポートしている。
- `modules/board.py`：チェスボードのクラスの定義
- `modules/minimax.py`：探索アルゴリズムの実装
- `modules/__init__.py`：Pythonのモジュール関連ファイル
- `pyproject.toml`：必要なパッケージ等の管理ファイル
- `README.md`：本ファイル
- `scripts/searchX.sh`：小問Xの探索に利用するコマンドを記したシェルスクリプト
- `uv.lock`：パッケージ管理ツールuvのバージョンロックファイル
